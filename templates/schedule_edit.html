{% extends 'base.html' %}
{% load static %}
{% load schedule_filters %}

{% block title %}Расписание Көрүү{% endblock %}

{% block content %}
<div class="timetable-container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="timetable-title"><i class="fas fa-eye me-2"></i>Расписание Көрүү</h2>
        <div class="alert alert-info mb-0 py-2 px-3">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Көрүү режими:</strong> Расписанияны жөн гана көрүү үчүн
        </div>
    </div>
    <div class="course-selector">
        {% for course in courses %}
        <button class="course-btn {% if forloop.first %}active-course-btn{% endif %}" 
                onclick="showCourseTable({{ course.id }})">
            {{ course.name }}
        </button>
        {% endfor %}
    </div>

    {% for course in courses %}
    <div id="course-{{ course.id }}" class="course-table" style="display: {% if forloop.first %}block{% else %}none{% endif %}">
        <h3>{{ course.name }}</h3>
        <!-- Көрүү режиминде form керек эмес -->
        <div class="table-responsive">
            <table class="table table-bordered table-hover view-only-table">
                <thead class="table-dark">
                    <tr>
                        <th width="5%">Пара</th>
                        <th width="15%">Убакыт</th>
                        {% for group in course.group_set.all %}
                        <th width="{% widthratio 80 course.group_set.all|length 1 %}%">{{ group.name }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for period in periods %}
                    <tr>
                        <td class="text-center fw-bold">{{ forloop.counter }}</td>
                        <td class="text-center">{{ period.start_time|time:"H:i" }} - {{ period.end_time|time:"H:i" }}</td>
                        {% for group in course.group_set.all %}
                        <td class="schedule-cell">
                            {% with schedule=schedules|filter_schedule:group.id|add:','|add:forloop.counter %}
                            {% if schedule %}
                            <div class="schedule-info">
                                <div class="subject-name text-primary fw-bold">
                                    <i class="fas fa-book me-1"></i>{{ schedule.subject.subject_name|default:"Сабак аты жок" }}
                                </div>
                                <div class="teacher-name text-success">
                                    <i class="fas fa-user-tie me-1"></i>{{ schedule.subject.teacher.name|default:"Мугалим жок" }}
                                </div>
                                <div class="room-info text-info">
                                    <i class="fas fa-door-open me-1"></i>{{ schedule.room|default:"Кабинет жок" }}
                                </div>
                            </div>
                            {% else %}
                            <div class="no-schedule text-muted text-center">
                                <i class="fas fa-calendar-times"></i><br>
                                <small>Жок</small>
                            </div>
                            {% endif %}
                            {% endwith %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <!-- Көрүү режиминде сактоо батмасы керек эмес -->
    </div>
    {% endfor %}
</div>

<style>
.view-only-table {
    background: #fff;
}

.schedule-cell {
    vertical-align: top;
    padding: 10px;
    min-height: 80px;
}

.schedule-info {
    text-align: left;
}

.subject-name {
    font-size: 0.9em;
    margin-bottom: 3px;
}

.teacher-name {
    font-size: 0.8em;
    margin-bottom: 2px;
}

.room-info {
    font-size: 0.8em;
}

.no-schedule {
    padding: 20px 5px;
}

.course-selector .course-btn {
    margin: 0 5px 10px 0;
    padding: 10px 20px;
    background: #6c757d;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s;
}

.course-selector .course-btn:hover {
    background: #5a6268;
    transform: translateY(-2px);
}

.course-selector .active-course-btn {
    background: #007bff;
}

.timetable-container {
    padding: 20px;
}

.alert {
    font-size: 0.9em;
}
</style>

<script>
function showCourseTable(courseId) {
    document.querySelectorAll('.course-table').forEach(table => table.style.display = 'none');
    document.getElementById(`course-${courseId}`).style.display = 'block';
    document.querySelectorAll('.course-btn').forEach(btn => btn.classList.remove('active-course-btn'));
    event.target.classList.add('active-course-btn');
}

// Көрүү режиминде түзөтүү функциялары керек эмес
// Жөн гана курс алмашуу функциясы калтырылды
</script>
{% endblock %}