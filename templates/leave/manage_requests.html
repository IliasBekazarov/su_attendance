{% extends 'base.html' %}
{% block title %}–ë–æ—à–æ—Ç—É—É —Å—É—Ä–∞–º–¥–∞—Ä—ã–Ω –±–∞—à–∫–∞—Ä—É—É{% endblock %}
{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">üõ†Ô∏è –ë–æ—à–æ—Ç—É—É —Å—É—Ä–∞–º–¥–∞—Ä—ã–Ω –±–∞—à–∫–∞—Ä—É—É</h2>
    
    <!-- –ö“Ø—Ç“Ø“Ø–¥”©–≥“Ø —Å—É—Ä–∞–º–¥–∞—Ä -->
    <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
            <h5 class="mb-0">‚è≥ –ö“Ø—Ç“Ø“Ø–¥”©–≥“Ø —Å—É—Ä–∞–º–¥–∞—Ä ({{ pending_requests|length }})</h5>
        </div>
        <div class="card-body">
            {% if pending_requests %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                            <th>–¢“Ø—Ä“Ø</th>
                            <th>–ú”©”©–Ω”©—Ç“Ø</th>
                            <th>–ö“Ø–Ω–¥”©—Ä</th>
                            <th>–°–µ–±–µ–±–∏</th>
                            <th>–ñ”©–Ω”©—Ç“Ø–ª–≥”©–Ω</th>
                            <th>–ê—Ä–∞–∫–µ—Ç—Ç–µ—Ä</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for request in pending_requests %}
                        <tr>
                            <td>
                                <strong>{{ request.student.name }}</strong><br>
                                <small class="text-muted">{{ request.student.group.name }}</small>
                            </td>
                            <td>
                                <span class="badge bg-info">
                                    {{ request.get_leave_type_display }}
                                </span>
                            </td>
                            <td>
                                <small>
                                    {{ request.start_date }}<br>
                                    {{ request.end_date }}
                                </small>
                            </td>
                            <td>
                                <strong>{{ request.duration }} –∫“Ø–Ω</strong>
                            </td>
                            <td>
                                <div style="max-width: 200px;">
                                    {{ request.reason|truncatewords:15 }}
                                </div>
                            </td>
                            <td>
                                <small class="text-muted">
                                    {{ request.created_at|date:"d.m.Y H:i" }}
                                </small>
                            </td>
                            <td>
                                <form method="POST" action="{% url 'approve_leave_request' request.id %}" class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" name="action" value="approve" 
                                            class="btn btn-success btn-sm"
                                            onclick="return confirm('–ë—É–ª —Å—É—Ä–∞–º–¥—ã –±–µ–∫–∏—Ç–µ—Å–∏–∑–±–∏?')">
                                        ‚úÖ –ë–µ–∫–∏—Ç“Ø“Ø
                                    </button>
                                    <button type="submit" name="action" value="reject" 
                                            class="btn btn-danger btn-sm"
                                            onclick="return confirm('–ë—É–ª —Å—É—Ä–∞–º–¥—ã —á–µ—Ç–∫–µ –∫–∞–≥–∞—Å—ã–∑–±—ã?')">
                                        ‚ùå –ß–µ—Ç–∫–µ –∫–∞–≥—É—É
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-4">
                <p class="text-muted">‚úÖ –ö“Ø—Ç“Ø“Ø–¥”©–≥“Ø —Å—É—Ä–∞–º–¥–∞—Ä –∂–æ–∫</p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- –ë–∞—Ä–¥—ã–∫ —Å—É—Ä–∞–º–¥–∞—Ä–¥—ã–Ω —Ç–∞—Ä—ã—Ö—ã -->
    <div class="card">
        <div class="card-header bg-secondary text-white">
            <h5 class="mb-0">üìú –ë–∞—Ä–¥—ã–∫ —Å—É—Ä–∞–º–¥–∞—Ä–¥—ã–Ω —Ç–∞—Ä—ã—Ö—ã</h5>
        </div>
        <div class="card-body">
            {% if all_requests %}
            <div class="table-responsive">
                <table class="table table-hover table-sm">
                    <thead>
                        <tr>
                            <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                            <th>–¢“Ø—Ä“Ø</th>
                            <th>–ú”©”©–Ω”©—Ç“Ø</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–ß–µ—á–∫–∏–º –∫–∞–±—ã–ª –∞–ª–≥–∞–Ω</th>
                            <th>–î–∞—Ç–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for request in all_requests %}
                        <tr>
                            <td>
                                <strong>{{ request.student.name }}</strong><br>
                                <small class="text-muted">{{ request.student.group.name }}</small>
                            </td>
                            <td>
                                <span class="badge bg-info">
                                    {{ request.get_leave_type_display }}
                                </span>
                            </td>
                            <td>
                                <small>
                                    {{ request.start_date }} - {{ request.end_date }}<br>
                                    <strong>({{ request.duration }} –∫“Ø–Ω)</strong>
                                </small>
                            </td>
                            <td>
                                {% if request.status == 'PENDING' %}
                                    <span class="badge bg-warning text-dark">‚è≥ –ö“Ø—Ç“Ø“Ø–¥”©</span>
                                {% elif request.status == 'APPROVED' %}
                                    <span class="badge bg-success">‚úÖ –ë–µ–∫–∏—Ç–∏–ª–≥–µ–Ω</span>
                                {% else %}
                                    <span class="badge bg-danger">‚ùå –ß–µ—Ç–∫–µ –∫–∞–≥—ã–ª–≥–∞–Ω</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if request.approved_by %}
                                    {{ request.approved_by.get_full_name|default:request.approved_by.username }}
                                {% else %}
                                    <small class="text-muted">‚Äî</small>
                                {% endif %}
                            </td>
                            <td>
                                <small class="text-muted">
                                    {{ request.created_at|date:"d.m.Y H:i" }}
                                </small>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-4">
                <p class="text-muted">üìã –ê–∑—ã—Ä—ã–Ω—á–∞ —Å—É—Ä–∞–º–¥–∞—Ä –∂–æ–∫</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.table th {
    border-top: none;
    font-weight: 600;
}
.badge {
    font-size: 0.875rem;
}
.btn-sm {
    padding: 0.25rem 0.5rem;
}
</style>
{% endblock %}
